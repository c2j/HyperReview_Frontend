import React, { createContext, useState, useContext, ReactNode } from 'react';

type Language = 'zh' | 'en';

const translations = {
  zh: {
    'app.title': 'HyperReview v3.1',
    'titlebar.search': '全局搜索 (Ctrl+F)',
    'titlebar.mode': '代码审核模式',
    'titlebar.semantic': '语义上下文',
    'titlebar.syncing': '同步中',
    'titlebar.sync_online': '系统在线',
    'titlebar.settings': '设置',
    'titlebar.help': '新手引导',
    'toolbar.open_repo': '打开仓库',
    'toolbar.import_task': '导入任务',
    'toolbar.submit_to': '提交至',
    'toolbar.quick_tags': '快捷标签',
    'toolbar.manage': '管理...',
    'toolbar.current_repo': '当前仓库',
    'toolbar.files_pending': '待审文件',
    'toolbar.switch_branch': '切换/对比分支...',
    'toolbar.diff_stats': '显示差异统计',
    'tasktree.review_pending': '待评审',
    'tasktree.watching': '关注中',
    'tasktree.history': '历史记录',
    'tasktree.no_history': '今日无记录',
    'tasktree.create_task': '创建本地任务',
    'diffview.file': '文件',
    'diffview.maximize': '最大化视图',
    'diffview.restore': '还原视图',
    'diffview.fold_imports': '折叠引用',
    'diffview.fold_lombok': '折叠Lombok',
    'diffview.line_wrap': '自动换行',
    'diffview.search.placeholder': '在当前文件中查找',
    'diffview.search.no_results': '无结果',
    'diffview.header.old': '旧版 (v1)',
    'diffview.header.new': '新版 (v2)',
    'diffview.header.heatmap': '热力',
    'diffview.header.main': '主战场 (Code)',
    'diffview.view.diff': '对比视图 (Diff)',
    'diffview.view.old': '完整旧版',
    'diffview.view.new': '完整新版',
    'contextmenu.must_change': '必须改',
    'contextmenu.concern': '标记关注',
    'contextmenu.question': '提问作者',
    'contextmenu.approve_hunk': '通过此 Hunk',
    'contextmenu.insert_template': '插入模板',
    'contextmenu.template.transaction': '事务边界缺失',
    'contextmenu.template.nplus1': '潜在 N+1',
    'contextmenu.template.hardcoded': '硬编码 SQL',
    'contextmenu.generate_patch': '生成修复补丁',
    'rightpanel.tab.heatmap': '热力图',
    'rightpanel.tab.blame': '追溯',
    'rightpanel.tab.stats': '统计',
    'rightpanel.tab.list': '列表',
    'rightpanel.heatmap.title': '架构影响热力图',
    'rightpanel.heatmap.desc': '当前PR影响的模块',
    'rightpanel.heatmap.impact.high': '高影响',
    'rightpanel.heatmap.impact.medium': '中影响',
    'rightpanel.heatmap.impact.low': '低影响',
    'rightpanel.blame.reviewer': '评审人',
    'rightpanel.stats.title': '评审进度',
    'rightpanel.stats.reviewed': '已审文件',
    'rightpanel.stats.severe': '严重',
    'rightpanel.stats.warning': '警告',
    'rightpanel.stats.pending': '待回复',
    'rightpanel.stats.time': '预估时间',
    'rightpanel.list.title': '待审文件清单',
    'rightpanel.list.no_items': '无待审项',
    'rightpanel.list.select_all': '[全选]',
    'rightpanel.list.invert': '[反选]',
    'rightpanel.list.remove': '[移除]',
    'actionbar.approve': '文件通过审核',
    'actionbar.concern': '标记关注',
    'actionbar.reject': '必须改',
    'actionbar.question': '提问作者',
    'actionbar.comment': '写评论',
    'actionbar.go_def': '跳定义',
    'actionbar.blame': 'Blame',
    'actionbar.ref_line': '引用行',
    'actionbar.next_file': '下一文件',
    'actionbar.submit_batch': '整批审完并推送',
    'actionbar.switch_panel': '切右侧面板',
    'actionbar.exit': '退出评论',
    'actionbar.submit': '提交评审',
    'statusbar.live': '实时',
    'statusbar.saved': '本地已保存',
    'statusbar.files': '文件',
    'statusbar.marked': '已标记',
    'statusbar.ready': '准备就绪 → 推送至 CodeArts (OpenAPI)',
    'modal.open_repo.step1': '步骤 1/2: 选择 Git 仓库',
    'modal.open_repo.search': '搜索仓库路径...',
    'modal.open_repo.recent': '最近打开',
    'modal.open_repo.next': '下一步：选择版本',
    'modal.open_repo.cancel': '取消',
    'modal.open_repo.open_local': '打开本地目录',
    'modal.open_repo.empty_desc': '暂无最近记录，请打开一个包含 .git 的目录开始工作。',
    'modal.import_task.title': '导入任务',
    'modal.import_task.label': '从URL、Issue ID或PR#导入',
    'modal.import_task.or': '或',
    'modal.import_task.drag': '点击上传或拖拽',
    'modal.import_task.supports': '支持 .patch, .diff, .zip (最大 20MB)',
    'modal.import_task.import': '导入任务',
    'modal.import_task.cancel': '取消',
    'modal.create_task.title': '创建本地任务',
    'modal.create_task.label_title': '任务标题',
    'modal.create_task.label_type': '评审类型',
    'modal.create_task.type_code': '通用代码',
    'modal.create_task.type_sql': 'SQL / 结构',
    'modal.create_task.type_security': '安全审计',
    'modal.create_task.create': '创建任务',
    'modal.create_task.cancel': '取消',
    'modal.tag_manager.title': '管理快捷标签',
    'modal.tag_manager.no_tags': '未定义标签',
    'modal.tag_manager.add': '添加新标签',
    'modal.tag_manager.placeholder': '标签名称 (如：安全风险)',
    'modal.tag_manager.done': '完成',
    'modal.sync.title': '远程同步状态',
    'modal.sync.syncing': '同步中...',
    'modal.sync.uptodate': '已是最新',
    'modal.sync.pulling': '正在拉取最新代码',
    'modal.sync.last_sync': '上次成功同步：刚刚',
    'modal.sync.close': '关闭',
    'modal.submit.title': '提交评审',
    'modal.submit.ready': '准备发布？',
    'modal.submit.gates': '质量门禁',
    'modal.submit.summary': '评审摘要',
    'modal.submit.approve_merge': '批准并合并',
    'modal.submit.cancel': '取消',
    'modal.submit.submitting': '提交中...',
    'modal.settings.title': '编辑器偏好设置',
    'modal.settings.general': '常规',
    'modal.settings.editor': '编辑器',
    'modal.settings.shortcuts': '快捷键',
    'modal.settings.ai': 'AI 分析',
    'modal.settings.language': '语言',
    'modal.settings.appearance': '外观',
    'modal.settings.behavior': '行为',
    'modal.settings.font_size': '字体大小',
    'modal.settings.font_size_desc': '编辑器字号(px)',
    'modal.settings.ligatures': '字体连字',
    'modal.settings.ligatures_desc': '启用编程字体连字特性',
    'modal.settings.vim': 'Vim 模式',
    'modal.settings.vim_desc': '启用 Vim 键位绑定',
    'modal.settings.done': 'Done',
    'modal.review_action.concern': '标记关注',
    'modal.review_action.reject': 'Request Changes',
    'modal.review_action.question': 'Ask Question',
    'modal.review_action.comment': 'Add Comment',
    'modal.review_action.post': 'Post Review',
    'modal.review_action.cancel': 'Cancel',
    'modal.review_action.markdown': 'Markdown supported',
    'modal.branch_compare.title': '对比分支设置',
    'modal.branch_compare.step2': '步骤 2/2: 确定评审基线',
    'modal.branch_compare.base': '基准分支 (旧版)',
    'modal.branch_compare.compare': '对比分支 (新版)',
    'modal.branch_compare.swap': '交换',
    'modal.branch_compare.apply': '应用配置',
    'modal.branch_compare.start': '开始评审',
    'modal.branch_compare.back': '上一步',
    'command.placeholder': '搜索文件 (Ctrl+P), 符号 (#), 或命令 (>)...',
    'command.esc': 'ESC',
    'command.tips': '使用 ↑↓ 导航, Enter 选择',
    
    // Tour
    'tour.welcome.title': '欢迎使用 HyperReview',
    'tour.welcome.content': '这是一款专为技术负责人打造的高性能代码评审终端。让我们花 1 分钟了解核心功能。',
    'tour.tasks.title': '任务导航区',
    'tour.tasks.content': '在这里管理您的待评审PR、关注的变更以及本地创建的任务。支持多层级文件树浏览。',
    'tour.diff.title': 'Diff 主战场',
    'tour.diff.content': '核心审阅区域。支持语法高亮、快捷跳转、右键插入评审模板，以及 Ctrl+F 局部搜索。',
    'tour.action.title': '快捷决策栏',
    'tour.action.content': '评审的关键动作区。快速批准、驳回或标记问题。支持全键盘操作 (如 Shift+Enter 批量提交)。',
    'tour.right.title': '多维辅助面板',
    'tour.right.content': '查看架构热力图、Git Blame 追溯、评审统计数据以及待办清单。',
    'tour.toolbar.title': '全局工具栏',
    'tour.toolbar.content': '打开仓库、导入 Patch、切换分支，或使用快捷标签过滤严重问题。',
    'tour.finish.title': '准备就绪',
    'tour.finish.content': '您已了解基本操作。按 Esc 随时退出引导，祝您评审愉快！',
    'tour.next': '下一步',
    'tour.prev': '上一步',
    'tour.finish': '开始使用',
    'tour.skip': '跳过',
  },
  en: {
    'app.title': 'HyperReview v3.1',
    'titlebar.search': 'Global Search (Ctrl+F)',
    'titlebar.mode': 'Code Review Mode',
    'titlebar.semantic': 'Semantic Context',
    'titlebar.syncing': 'Syncing',
    'titlebar.sync_online': 'System Online',
    'titlebar.settings': 'Settings',
    'titlebar.help': 'Tour Guide',
    'toolbar.open_repo': 'Open Repo',
    'toolbar.import_task': 'Import Task',
    'toolbar.submit_to': 'Submit to',
    'toolbar.quick_tags': 'Quick Tags',
    'toolbar.manage': 'Manage...',
    'toolbar.current_repo': 'Current Repo',
    'toolbar.files_pending': 'Files Pending',
    'toolbar.switch_branch': 'Switch Branch...',
    'toolbar.diff_stats': 'Showing Diff Stats',
    'tasktree.review_pending': 'Review Pending',
    'tasktree.watching': 'Watching',
    'tasktree.history': 'History',
    'tasktree.no_history': 'No history for today',
    'tasktree.create_task': 'Create Local Task',
    'diffview.file': 'File',
    'diffview.maximize': 'Maximize View',
    'diffview.restore': 'Restore View',
    'diffview.fold_imports': 'Fold Imports',
    'diffview.fold_lombok': 'Fold Lombok',
    'diffview.line_wrap': 'Line Wrap',
    'diffview.search.placeholder': 'Find in file',
    'diffview.search.no_results': 'No results',
    'diffview.header.old': 'Old (v1)',
    'diffview.header.new': 'New (v2)',
    'diffview.header.heatmap': 'Map',
    'diffview.header.main': 'Main Arena',
    'diffview.view.diff': 'Diff View',
    'diffview.view.old': 'Old File',
    'diffview.view.new': 'New File',
    'contextmenu.must_change': 'Must Change',
    'contextmenu.concern': 'Mark Concern',
    'contextmenu.question': 'Ask Question',
    'contextmenu.approve_hunk': 'Approve Hunk',
    'contextmenu.insert_template': 'Insert Template',
    'contextmenu.template.transaction': 'Missing Transaction',
    'contextmenu.template.nplus1': 'Potential N+1',
    'contextmenu.template.hardcoded': 'Hardcoded SQL',
    'contextmenu.generate_patch': 'Generate Fix Patch',
    'rightpanel.tab.heatmap': 'Heatmap',
    'rightpanel.tab.blame': 'Blame',
    'rightpanel.tab.stats': 'Stats',
    'rightpanel.tab.list': 'List',
    'rightpanel.heatmap.title': 'Architecture Impact Heatmap',
    'rightpanel.heatmap.desc': 'Modules affected by current PR',
    'rightpanel.heatmap.impact.high': 'High Impact',
    'rightpanel.heatmap.impact.medium': 'Medium Impact',
    'rightpanel.heatmap.impact.low': 'Low Impact',
    'rightpanel.blame.reviewer': 'Reviewer',
    'rightpanel.stats.title': 'Review Progress',
    'rightpanel.stats.reviewed': 'Reviewed Files',
    'rightpanel.stats.severe': 'Severe',
    'rightpanel.stats.warning': 'Warning',
    'rightpanel.stats.pending': 'Pending Reply',
    'rightpanel.stats.time': 'Est. Time',
    'rightpanel.list.title': 'Pending Files',
    'rightpanel.list.no_items': 'No items pending.',
    'rightpanel.list.select_all': '[Select All]',
    'rightpanel.list.invert': '[Invert]',
    'rightpanel.list.remove': '[Remove]',
    'actionbar.approve': 'File Approved',
    'actionbar.concern': 'Mark Concern',
    'actionbar.reject': 'Must Change',
    'actionbar.question': 'Ask Author',
    'actionbar.comment': 'Comment',
    'actionbar.go_def': 'Go Def',
    'actionbar.blame': 'Blame',
    'actionbar.ref_line': 'Ref Line',
    'actionbar.next_file': 'Next File',
    'actionbar.submit_batch': 'Batch Submit & Push',
    'actionbar.switch_panel': 'Switch Panel',
    'actionbar.exit': 'Exit',
    'actionbar.submit': 'Submit Review',
    'statusbar.live': 'LIVE',
    'statusbar.saved': 'Saved locally',
    'statusbar.files': 'Files',
    'statusbar.marked': 'Marked',
    'statusbar.ready': 'Ready → Push to CodeArts (OpenAPI)',
    'modal.open_repo.step1': 'Step 1/2: Select Git Repository',
    'modal.open_repo.search': 'Search repository path...',
    'modal.open_repo.recent': 'Recent',
    'modal.open_repo.next': 'Next: Select Version',
    'modal.open_repo.cancel': 'Cancel',
    'modal.open_repo.open_local': 'Open Local Directory',
    'modal.open_repo.empty_desc': 'No recent records. Open a directory containing .git to start.',
    'modal.import_task.title': 'Import Task',
    'modal.import_task.label': 'Import from URL, Issue ID, or PR#',
    'modal.import_task.or': 'OR',
    'modal.import_task.drag': 'Click to upload or drag & drop',
    'modal.import_task.supports': 'Supports .patch, .diff, .zip (max 20MB)',
    'modal.import_task.import': 'Import Task',
    'modal.import_task.cancel': 'Cancel',
    'modal.create_task.title': 'Create Local Task',
    'modal.create_task.label_title': 'Task Title',
    'modal.create_task.label_type': 'Review Type',
    'modal.create_task.type_code': 'General Code',
    'modal.create_task.type_sql': 'SQL / Schema',
    'modal.create_task.type_security': 'Security Audit',
    'modal.create_task.create': 'Create Task',
    'modal.create_task.cancel': 'Cancel',
    'modal.tag_manager.title': 'Manage Quick Tags',
    'modal.tag_manager.no_tags': 'No tags defined',
    'modal.tag_manager.add': 'Add New Tag',
    'modal.tag_manager.placeholder': 'Tag name (e.g. \'Security Risk\')',
    'modal.tag_manager.done': 'Done',
    'modal.sync.title': 'Remote Sync Status',
    'modal.sync.syncing': 'Synchronizing...',
    'modal.sync.uptodate': 'Everything Up-to-Date',
    'modal.sync.pulling': 'Pulling latest changes from CodeArts',
    'modal.sync.last_sync': 'Last successful sync: Just now',
    'modal.sync.close': 'Close',
    'modal.submit.title': 'Submit Review',
    'modal.submit.ready': 'Ready to Ship?',
    'modal.submit.gates': 'Quality Gates',
    'modal.submit.summary': 'Review Summary',
    'modal.submit.approve_merge': 'Approve & Merge',
    'modal.submit.cancel': 'Cancel',
    'modal.submit.submitting': 'Submitting...',
    'modal.settings.title': 'Editor Preferences',
    'modal.settings.general': 'General',
    'modal.settings.editor': 'Editor',
    'modal.settings.shortcuts': 'Shortcuts',
    'modal.settings.ai': 'AI Analysis',
    'modal.settings.language': 'Language',
    'modal.settings.appearance': 'Appearance',
    'modal.settings.behavior': 'Behavior',
    'modal.settings.font_size': 'Font Size',
    'modal.settings.font_size_desc': 'Editor text size in pixels',
    'modal.settings.ligatures': 'Font Ligatures',
    'modal.settings.ligatures_desc': 'Enable specialized programming glyphs',
    'modal.settings.vim': 'Vim Mode',
    'modal.settings.vim_desc': 'Enable Vim keybindings for navigation',
    'modal.settings.done': 'Done',
    'modal.review_action.concern': 'Mark Concern',
    'modal.review_action.reject': 'Request Changes',
    'modal.review_action.question': 'Ask Question',
    'modal.review_action.comment': 'Add Comment',
    'modal.review_action.post': 'Post Review',
    'modal.review_action.cancel': 'Cancel',
    'modal.review_action.markdown': 'Markdown supported',
    'modal.branch_compare.title': 'Branch Comparison',
    'modal.branch_compare.step2': 'Step 2/2: Define Review Baseline',
    'modal.branch_compare.base': 'Base Branch (Old)',
    'modal.branch_compare.compare': 'Compare Branch (New)',
    'modal.branch_compare.swap': 'Swap',
    'modal.branch_compare.apply': 'Apply Config',
    'modal.branch_compare.start': 'Start Review',
    'modal.branch_compare.back': 'Back',
    'command.placeholder': 'Search files (Ctrl+P), symbols (#), or commands (>)...',
    'command.esc': 'ESC',
    'command.tips': 'Use ↑↓ to navigate, Enter to select',

    // Tour
    'tour.welcome.title': 'Welcome to HyperReview',
    'tour.welcome.content': 'A high-performance terminal designed for Tech Leads. Let\'s take a 1-minute tour.',
    'tour.tasks.title': 'Task Navigation',
    'tour.tasks.content': 'Manage PRs, watched changes, and local tasks here. Supports multi-level file tree navigation.',
    'tour.diff.title': 'The Diff Arena',
    'tour.diff.content': 'Your main review workspace. Features syntax highlighting, jump-to-def, and right-click templates.',
    'tour.action.title': 'Decision Bar',
    'tour.action.content': 'Key review actions live here. Approve, Reject, or Comment. Fully keyboard accessible.',
    'tour.right.title': 'Insights Panel',
    'tour.right.content': 'Check architecture heatmaps, Git blame details, and your review checklist.',
    'tour.toolbar.title': 'Global Toolbar',
    'tour.toolbar.content': 'Open repos, import patches, switch branches, or filter issues by tag.',
    'tour.finish.title': 'Ready to Go',
    'tour.finish.content': 'You are all set. Press Esc anytime to exit the tour. Happy Reviewing!',
    'tour.next': 'Next',
    'tour.prev': 'Back',
    'tour.finish': 'Start',
    'tour.skip': 'Skip',
  }
};

const LanguageContext = createContext<{
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string) => string;
}>({
  language: 'zh',
  setLanguage: () => {},
  t: (key) => key,
});

export const LanguageProvider: React.FC<{children: ReactNode}> = ({ children }) => {
  const [language, setLanguage] = useState<Language>('zh');

  const t = (key: string): string => {
    return (translations[language] as any)[key] || key;
  };

  return (
    <LanguageContext.Provider value={{ language, setLanguage, t }}>
      {children}
    </LanguageContext.Provider>
  );
};

export const useTranslation = () => useContext(LanguageContext);